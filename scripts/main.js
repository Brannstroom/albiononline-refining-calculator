const resources = {
    fiber: [
        {
            name: "Cotton",
            image: "fiber/T2_FIBER.webp",
            item_value: 4,
            tier: 2,
            enchant: 0,
        },
        {
            name: "Flax",
            image: "fiber/T3_FIBER.webp",
            item_value: 2,
            tier: 3,
            enchant: 0,
        },
        {
            name: "Hemp",
            image: "fiber/T4_FIBER.webp",
            item_value: 4,
            tier: 4,
            enchant: 0,
        },
        {
            name: "Uncommon Hemp",
            image: "fiber/T4_FIBER_LEVEL1.webp",
            item_value: 12,
            tier: 4,
            enchant: 1,
        },
        {
            name: "Rare Hemp",
            image: "fiber/T4_FIBER_LEVEL2.webp",
            item_value: 28,
            tier: 4,
            enchant: 2,
        },
        {
            name: "Exceptional Hemp",
            image: "fiber/T4_FIBER_LEVEL3.webp",
            item_value: 60,
            tier: 4,
            enchant: 3,
        },
        {
            name: "Pristine Hemp",
            image: "fiber/T4_FIBER_LEVEL4.webp",
            item_value: 120,
            tier: 4,
            enchant: 4,
        },
        {
            name: "Skyflower",
            image: "fiber/T5_FIBER.webp",
            item_value: 4,
            tier: 5,
            enchant: 0,
        },
        {
            name: "Uncommon Skyflower",
            image: "fiber/T5_FIBER_LEVEL1.webp",
            item_value: 10,
            tier: 5,
            enchant: 1,
        },
        {
            name: "Rare Skyflower",
            image: "fiber/T5_FIBER_LEVEL2.webp",
            item_value: 21,
            tier: 5,
            enchant: 2,
        },
        {
            name: "Exceptional Skyflower",
            image: "fiber/T5_FIBER_LEVEL3.webp",
            item_value: 42,
            tier: 5,
            enchant: 3,
        },
        {
            name: "Pristine Skyflower",
            image: "fiber/T5_FIBER_LEVEL4.webp",
            item_value: 85,
            tier: 5,
            enchant: 4,
        },
        {
            name: "Amberleaf Cotton",
            image: "fiber/T6_FIBER.webp",
            item_value: 8,
            tier: 6,
            enchant: 0,
        },
        {
            name: "Uncommon Amberleaf Cotton",
            image: "fiber/T6_FIBER_LEVEL1.webp",
            item_value: 16,
            tier: 6,
            enchant: 1,
        },
        {
            name: "Rare Amberleaf Cotton",
            image: "fiber/T6_FIBER_LEVEL2.webp",
            item_value: 32,
            tier: 6,
            enchant: 2,
        },
        {
            name: "Exceptional Amberleaf Cotton",
            image: "fiber/T6_FIBER_LEVEL3.webp",
            item_value: 64,
            tier: 6,
            enchant: 3,
        },
        {
            name: "Pristine Amberleaf Cotton",
            image: "fiber/T6_FIBER_LEVEL4.webp",
            item_value: 128,
            tier: 6,
            enchant: 4,
        },
        {
            name: "Sunflax",
            image: "fiber/T7_FIBER.webp",
            item_value: 12,
            tier: 7,
            enchant: 0,
        },
        {
            name: "Uncommon Sunflax",
            image: "fiber/T7_FIBER_LEVEL1.webp",
            item_value: 25,
            tier: 7,
            enchant: 1,
        },
        {
            name: "Rare Sunflax",
            image: "fiber/T7_FIBER_LEVEL2.webp",
            item_value: 51,
            tier: 7,
            enchant: 2,
        },
        {
            name: "Exceptional Sunflax",
            image: "fiber/T7_FIBER_LEVEL3.webp",
            item_value: 102,
            tier: 7,
            enchant: 3,
        },
        {
            name: "Pristine Sunflax",
            image: "fiber/T7_FIBER_LEVEL4.webp",
            item_value: 204,
            tier: 7,
            enchant: 4,
        },
        {
            name: "Ghost Hemp",
            image: "fiber/T8_FIBER.webp",
            item_value: 25,
            tier: 8,
            enchant: 0,
        },
        {
            name: "Uncommon Ghost Hemp",
            image: "fiber/T8_FIBER_LEVEL1.webp",
            item_value: 51,
            tier: 8,
            enchant: 1,
        },
        {
            name: "Rare Ghost Hemp",
            image: "fiber/T8_FIBER_LEVEL2.webp",
            item_value: 102,
            tier: 8,
            enchant: 2,
        },
        {
            name: "Exceptional Ghost Hemp",
            image: "fiber/T8_FIBER_LEVEL3.webp",
            item_value: 204,
            tier: 8,
            enchant: 3,
        },
        {
            name: "Pristine Ghost Hemp",
            image: "fiber/T8_FIBER_LEVEL4.webp",
            item_value: 409,
            tier: 8,
            enchant: 4,
        }
    ],
    ore: [
        {
            name: "Copper Ore",
            image: "ore/T2_ORE.webp",
            item_value: 4,
            tier: 2,
            enchant: 0,
        },
        {
            name: "Tin Ore",
            image: "ore/T3_ORE.webp",
            item_value: 2,
            tier: 3,
            enchant: 0,
        },
        {
            name: "Iron Ore",
            image: "ore/T4_ORE.webp",
            item_value: 4,
            tier: 4,
            enchant: 0,
        },
        {
            name: "Uncommon Iron Ore",
            image: "ore/T4_ORE_LEVEL1.webp",
            item_value: 12,
            tier: 4,
            enchant: 1,
        },
        {
            name: "Rare Iron Ore",
            image: "ore/T4_ORE_LEVEL2.webp",
            item_value: 28,
            tier: 4,
            enchant: 2,
        },
        {
            name: "Exceptional Iron Ore",
            image: "ore/T4_ORE_LEVEL3.webp",
            item_value: 60,
            tier: 4,
            enchant: 3,
        },
        {
            name: "Pristine Iron Ore",
            image: "ore/T4_ORE_LEVEL4.webp",
            item_value: 120,
            tier: 4,
            enchant: 4,
        },
        {
            name: "Titanium Ore",
            image: "ore/T5_ORE.webp",
            item_value: 4,
            tier: 5,
            enchant: 0,
        },
        {
            name: "Uncommon Titanium Ore",
            image: "ore/T5_ORE_LEVEL1.webp",
            item_value: 10,
            tier: 5,
            enchant: 1,
        },
        {
            name: "Rare Titanium Ore",
            image: "ore/T5_ORE_LEVEL2.webp",
            item_value: 21,
            tier: 5,
            enchant: 2,
        },
        {
            name: "Exceptional Titanium Ore",
            image: "ore/T5_ORE_LEVEL3.webp",
            item_value: 42,
            tier: 5,
            enchant: 3,
        },
        {
            name: "Pristine Titanium Ore",
            image: "ore/T5_ORE_LEVEL4.webp",
            item_value: 85,
            tier: 5,
            enchant: 4,
        },
        {
            name: "Runite Ore",
            image: "ore/T6_ORE.webp",
            item_value: 8,
            tier: 6,
            enchant: 0,
        },
        {
            name: "Uncommon Runite Ore",
            image: "ore/T6_ORE_LEVEL1.webp",
            item_value: 16,
            tier: 6,
            enchant: 1,
        },
        {
            name: "Rare Runite Ore",
            image: "ore/T6_ORE_LEVEL2.webp",
            item_value: 32,
            tier: 6,
            enchant: 2,
        },
        {
            name: "Exceptional Runite Ore",
            image: "ore/T6_ORE_LEVEL3.webp",
            item_value: 64,
            tier: 6,
            enchant: 3,
        },
        {
            name: "Pristine Runite Ore",
            image: "ore/T6_ORE_LEVEL4.webp",
            item_value: 128,
            tier: 6,
            enchant: 4,
        },
        {
            name: "Meteorite Ore",
            image: "ore/T7_ORE.webp",
            item_value: 12,
            tier: 7,
            enchant: 0,
        },
        {
            name: "Uncommon Meteorite Ore",
            image: "ore/T7_ORE_LEVEL1.webp",
            item_value: 25,
            tier: 7,
            enchant: 1,
        },
        {
            name: "Rare Meteorite Ore",
            image: "ore/T7_ORE_LEVEL2.webp",
            item_value: 51,
            tier: 7,
            enchant: 2,
        },
        {
            name: "Exceptional Meteorite Ore",
            image: "ore/T7_ORE_LEVEL3.webp",
            item_value: 102,
            tier: 7,
            enchant: 3,
        },
        {
            name: "Pristine Meteorite Ore",
            image: "ore/T7_ORE_LEVEL4.webp",
            item_value: 204,
            tier: 7,
            enchant: 4,
        },
        {
            name: "Adamantium Ore",
            image: "ore/T8_ORE.webp",
            item_value: 25,
            tier: 8,
            enchant: 0,
        },
        {
            name: "Uncommon Adamantium Ore",
            image: "ore/T8_ORE_LEVEL1.webp",
            item_value: 51,
            tier: 8,
            enchant: 1,
        },
        {
            name: "Rare Adamantium Ore",
            image: "ore/T8_ORE_LEVEL2.webp",
            item_value: 102,
            tier: 8,
            enchant: 2,
        },
        {
            name: "Exceptional Adamantium Ore",
            image: "ore/T8_ORE_LEVEL3.webp",
            item_value: 204,
            tier: 8,
            enchant: 3,
        },
        {
            name: "Pristine Adamantium Ore",
            image: "ore/T8_ORE_LEVEL4.webp",
            item_value: 409,
            tier: 8,
            enchant: 4,
        }
    ],
    hide: [
        {
            name: "Rugged Hide",
            image: "hide/T2_HIDE.webp",
            item_value: 4,
            tier: 2,
            enchant: 0,
        },
        {
            name: "Thin Hide",
            image: "hide/T3_HIDE.webp",
            item_value: 2,
            tier: 3,
            enchant: 0,
        },
        {
            name: "Medium Hide",
            image: "hide/T4_HIDE.webp",
            item_value: 4,
            tier: 4,
            enchant: 0,
        },
        {
            name: "Uncommon Medium Hide",
            image: "hide/T4_HIDE_LEVEL1.webp",
            item_value: 12,
            tier: 4,
            enchant: 1,
        },
        {
            name: "Rare Medium Hide",
            image: "hide/T4_HIDE_LEVEL2.webp",
            item_value: 28,
            tier: 4,
            enchant: 2,
        },
        {
            name: "Exceptional Medium Hide",
            image: "hide/T4_HIDE_LEVEL3.webp",
            item_value: 60,
            tier: 4,
            enchant: 3,
        },
        {
            name: "Pristine Medium Hide",
            image: "hide/T4_HIDE_LEVEL4.webp",
            item_value: 120,
            tier: 4,
            enchant: 4,
        },
        {
            name: "Heavy Hide",
            image: "hide/T5_HIDE.webp",
            item_value: 4,
            tier: 5,
            enchant: 0,
        },
        {
            name: "Uncommon Heavy Hide",
            image: "hide/T5_HIDE_LEVEL1.webp",
            item_value: 10,
            tier: 5,
            enchant: 1,
        },
        {
            name: "Rare Heavy Hide",
            image: "hide/T5_HIDE_LEVEL2.webp",
            item_value: 21,
            tier: 5,
            enchant: 2,
        },
        {
            name: "Exceptional Heavy Hide",
            image: "hide/T5_HIDE_LEVEL3.webp",
            item_value: 42,
            tier: 5,
            enchant: 3,
        },
        {
            name: "Pristine Heavy Hide",
            image: "hide/T5_HIDE_LEVEL4.webp",
            item_value: 85,
            tier: 5,
            enchant: 4,
        },
        {
            name: "Robust Hide",
            image: "hide/T6_HIDE.webp",
            item_value: 8,
            tier: 6,
            enchant: 0,
        },
        {
            name: "Uncommon Robust Hide",
            image: "hide/T6_HIDE_LEVEL1.webp",
            item_value: 16,
            tier: 6,
            enchant: 1,
        },
        {
            name: "Rare Robust Hide",
            image: "hide/T6_HIDE_LEVEL2.webp",
            item_value: 32,
            tier: 6,
            enchant: 2,
        },
        {
            name: "Exceptional Robust Hide",
            image: "hide/T6_HIDE_LEVEL3.webp",
            item_value: 64,
            tier: 6,
            enchant: 3,
        },
        {
            name: "Pristine Robust Hide",
            image: "hide/T6_HIDE_LEVEL4.webp",
            item_value: 128,
            tier: 6,
            enchant: 4,
        },
        {
            name: "Thick Hide",
            image: "hide/T7_HIDE.webp",
            item_value: 12,
            tier: 7,
            enchant: 0,
        },
        {
            name: "Uncommon Thick Hide",
            image: "hide/T7_HIDE_LEVEL1.webp",
            item_value: 25,
            tier: 7,
            enchant: 1,
        },
        {
            name: "Rare Thick Hide",
            image: "hide/T7_HIDE_LEVEL2.webp",
            item_value: 51,
            tier: 7,
            enchant: 2,
        },
        {
            name: "Exceptional Thick Hide",
            image: "hide/T7_HIDE_LEVEL3.webp",
            item_value: 102,
            tier: 7,
            enchant: 3,
        },
        {
            name: "Pristine Thick Hide",
            image: "hide/T7_HIDE_LEVEL4.webp",
            item_value: 204,
            tier: 7,
            enchant: 4,
        },
        {
            name: "Hardened Hide",
            image: "hide/T8_HIDE.webp",
            item_value: 25,
            tier: 8,
            enchant: 0,
        },
        {
            name: "Uncommon Hardened Hide",
            image: "hide/T8_HIDE_LEVEL1.webp",
            item_value: 51,
            tier: 8,
            enchant: 1,
        },
        {
            name: "Rare Hardened Hide",
            image: "hide/T8_HIDE_LEVEL2.webp",
            item_value: 102,
            tier: 8,
            enchant: 2,
        },
        {
            name: "Exceptional Hardened Hide",
            image: "hide/T8_HIDE_LEVEL3.webp",
            item_value: 204,
            tier: 8,
            enchant: 3,
        },
        {
            name: "Pristine Hardened Hide",
            image: "hide/T8_HIDE_LEVEL4.webp",
            item_value: 409,
            tier: 8,
            enchant: 4,
        }
    ],
    wood: [
        {
            name: "Birch Logs",
            image: "wood/T2_WOOD.webp",
            item_value: 4,
            tier: 2,
            enchant: 0,
        },
        {
            name: "Chestnut Logs",
            image: "wood/T3_WOOD.webp",
            item_value: 2,
            tier: 3,
            enchant: 0,
        },
        {
            name: "Pine Logs",
            image: "wood/T4_WOOD.webp",
            item_value: 4,
            tier: 4,
            enchant: 0,
        },
        {
            name: "Uncommon Pine Logs",
            image: "wood/T4_WOOD_LEVEL1.webp",
            item_value: 12,
            tier: 4,
            enchant: 1,
        },
        {
            name: "Rare Pine Logs",
            image: "wood/T4_WOOD_LEVEL2.webp",
            item_value: 28,
            tier: 4,
            enchant: 2,
        },
        {
            name: "Exceptional Pine Logs",
            image: "wood/T4_WOOD_LEVEL3.webp",
            item_value: 60,
            tier: 4,
            enchant: 3,
        },
        {
            name: "Pristine Pine Logs",
            image: "wood/T4_WOOD_LEVEL4.webp",
            item_value: 120,
            tier: 4,
            enchant: 4,
        },
        {
            name: "Cedar Logs",
            image: "wood/T5_WOOD.webp",
            item_value: 4,
            tier: 5,
            enchant: 0,
        },
        {
            name: "Uncommon Cedar Logs",
            image: "wood/T5_WOOD_LEVEL1.webp",
            item_value: 10,
            tier: 5,
            enchant: 1,
        },
        {
            name: "Rare Cedar Logs",
            image: "wood/T5_WOOD_LEVEL2.webp",
            item_value: 21,
            tier: 5,
            enchant: 2,
        },
        {
            name: "Exceptional Cedar Logs",
            image: "wood/T5_WOOD_LEVEL3.webp",
            item_value: 42,
            tier: 5,
            enchant: 3,
        },
        {
            name: "Pristine Cedar Logs",
            image: "wood/T5_WOOD_LEVEL4.webp",
            item_value: 85,
            tier: 5,
            enchant: 4,
        },
        {
            name: "Bloodoak Logs",
            image: "wood/T6_WOOD.webp",
            item_value: 8,
            tier: 6,
            enchant: 0,
        },
        {
            name: "Uncommon Bloodoak Logs",
            image: "wood/T6_WOOD_LEVEL1.webp",
            item_value: 16,
            tier: 6,
            enchant: 1,
        },
        {
            name: "Rare Bloodoak Logs",
            image: "wood/T6_WOOD_LEVEL2.webp",
            item_value: 32,
            tier: 6,
            enchant: 2,
        },
        {
            name: "Exceptional Bloodoak Logs",
            image: "wood/T6_WOOD_LEVEL3.webp",
            item_value: 64,
            tier: 6,
            enchant: 3,
        },
        {
            name: "Pristine Bloodoak Logs",
            image: "wood/T6_WOOD_LEVEL4.webp",
            item_value: 128,
            tier: 6,
            enchant: 4,
        },
        {
            name: "Ashenbark Logs",
            image: "wood/T7_WOOD.webp",
            item_value: 12,
            tier: 7,
            enchant: 0,
        },
        {
            name: "Uncommon Ashenbark Logs",
            image: "wood/T7_WOOD_LEVEL1.webp",
            item_value: 25,
            tier: 7,
            enchant: 1,
        },
        {
            name: "Rare Ashenbark Logs",
            image: "wood/T7_WOOD_LEVEL2.webp",
            item_value: 51,
            tier: 7,
            enchant: 2,
        },
        {
            name: "Exceptional Ashenbark Logs",
            image: "wood/T7_WOOD_LEVEL3.webp",
            item_value: 102,
            tier: 7,
            enchant: 3,
        },
        {
            name: "Pristine Ashenbark Logs",
            image: "wood/T7_WOOD_LEVEL4.webp",
            item_value: 204,
            tier: 7,
            enchant: 4,
        },
        {
            name: "Whitewood Logs",
            image: "wood/T8_WOOD.webp",
            item_value: 25,
            tier: 8,
            enchant: 0,
        },
        {
            name: "Uncommon Whitewood Logs",
            image: "wood/T8_WOOD_LEVEL1.webp",
            item_value: 51,
            tier: 8,
            enchant: 1,
        },
        {
            name: "Rare Whitewood Logs",
            image: "wood/T8_WOOD_LEVEL2.webp",
            item_value: 102,
            tier: 8,
            enchant: 2,
        },
        {
            name: "Exceptional Whitewood Logs",
            image: "wood/T8_WOOD_LEVEL3.webp",
            item_value: 204,
            tier: 8,
            enchant: 3,
        },
        {
            name: "Pristine Whitewood Logs",
            image: "wood/T8_WOOD_LEVEL4.webp",
            item_value: 409,
            tier: 8,
            enchant: 4,
        }
    ],
    rock: [
        {
            name: "Limestone",
            image: "rock/T2_ROCK.webp",
            item_value: 4,
            tier: 2,
            enchant: 0,
        },
        {
            name: "Sandstone",
            image: "rock/T3_ROCK.webp",
            item_value: 2,
            tier: 3,
            enchant: 0,
        },
        {
            name: "Travertine",
            image: "rock/T4_ROCK.webp",
            item_value: 4,
            tier: 4,
            enchant: 0,
        },
        {
            name: "Uncommon Travertine",
            image: "rock/T4_ROCK_LEVEL1.webp",
            item_value: 12,
            tier: 4,
            enchant: 1,
        },
        {
            name: "Rare Travertine",
            image: "rock/T4_ROCK_LEVEL2.webp",
            item_value: 28,
            tier: 4,
            enchant: 2,
        },
        {
            name: "Exceptional Travertine",
            image: "rock/T4_ROCK_LEVEL3.webp",
            item_value: 60,
            tier: 4,
            enchant: 3,
        },
        {
            name: "Granite",
            image: "rock/T5_ROCK.webp",
            item_value: 5,
            tier: 5,
            enchant: 0,
        },
        {
            name: "Uncommon Granite",
            image: "rock/T5_ROCK_LEVEL1.webp",
            item_value: 10,
            tier: 5,
            enchant: 1,
        },
        {
            name: "Rare Granite",
            image: "rock/T5_ROCK_LEVEL2.webp",
            item_value: 21,
            tier: 5,
            enchant: 2,
        },
        {
            name: "Exceptional Granite",
            image: "rock/T5_ROCK_LEVEL3.webp",
            item_value: 42,
            tier: 5,
            enchant: 3,
        },
        {
            name: "Slate",
            image: "rock/T6_ROCK.webp",
            item_value: 8,
            tier: 6,
            enchant: 0,
        },
        {
            name: "Uncommon Slate",
            image: "rock/T6_ROCK_LEVEL1.webp",
            item_value: 16,
            tier: 6,
            enchant: 1,
        },
        {
            name: "Rare Slate",
            image: "rock/T6_ROCK_LEVEL2.webp",
            item_value: 32,
            tier: 6,
            enchant: 2,
        },
        {
            name: "Exceptional Slate",
            image: "rock/T6_ROCK_LEVEL3.webp",
            item_value: 64,
            tier: 6,
            enchant: 3,
        },
        {
            name: "Basalt",
            image: "rock/T7_ROCK.webp",
            item_value: 12,
            tier: 7,
            enchant: 0,
        },
        {
            name: "Uncommon Basalt",
            image: "rock/T7_ROCK_LEVEL1.webp",
            item_value: 25,
            tier: 7,
            enchant: 1,
        },
        {
            name: "Rare Basalt",
            image: "rock/T7_ROCK_LEVEL2.webp",
            item_value: 51,
            tier: 7,
            enchant: 2,
        },
        {
            name: "Exceptional Basalt",
            image: "rock/T7_ROCK_LEVEL3.webp",
            item_value: 102,
            tier: 7,
            enchant: 3,
        },
        {
            name: "Marble",
            image: "rock/T8_ROCK.webp",
            item_value: 25,
            tier: 8,
            enchant: 0,
        },
        {
            name: "Uncommon Marble",
            image: "rock/T8_ROCK_LEVEL1.webp",
            item_value: 51,
            tier: 8,
            enchant: 1,
        },
        {
            name: "Rare Marble",
            image: "rock/T8_ROCK_LEVEL2.webp",
            item_value: 102,
            tier: 8,
            enchant: 2,
        },
        {
            name: "Exceptional Marble",
            image: "rock/T8_ROCK_LEVEL3.webp",
            item_value: 204,
            tier: 8,
            enchant: 3,
        }
    ]
}

const products = {
    cloth: [
        {
            name: "Simple Cloth",
            image: "cloth/T2_CLOTH.webp",
            item_value: 4,
            tier: 2,
            enchant: 0,
            focus_cost: 18,
        },
        {
            name: "Neat Cloth",
            image: "cloth/T3_CLOTH.webp",
            item_value: 8,
            tier: 3,
            enchant: 0,
            focus_cost: 31,
        },
        {
            name: "Fine Cloth",
            image: "cloth/T4_CLOTH.webp",
            item_value: 16,
            tier: 4,
            enchant: 0,
            focus_cost: 54,
        },
        {
            name: "Uncommon Fine Cloth",
            image: "cloth/T4_CLOTH_LEVEL1.webp",
            item_value: 32,
            tier: 4,
            enchant: 1,
            focus_cost: 94,
        },
        {
            name: "Rare Fine Cloth",
            image: "cloth/T4_CLOTH_LEVEL2.webp",
            item_value: 64,
            tier: 4,
            enchant: 2,
            focus_cost: 164,
        },
        {
            name: "Exceptional Fine Cloth",
            image: "cloth/T4_CLOTH_LEVEL3.webp",
            item_value: 128,
            tier: 4,
            enchant: 3,
            focus_cost: 287,
        },
        {
            name: "Pristine Fine Cloth",
            image: "cloth/T4_CLOTH_LEVEL4.webp",
            item_value: 256,
            tier: 4,
            enchant: 4,
            focus_cost: 503,
        },
        {
            name: "Ornate Cloth",
            image: "cloth/T5_CLOTH.webp",
            item_value: 32,
            tier: 5,
            enchant: 0,
            focus_cost: 94,
        },
        {
            name: "Uncommon Ornate Cloth",
            image: "cloth/T5_CLOTH_LEVEL1.webp",
            item_value: 64,
            tier: 5,
            enchant: 1,
            focus_cost: 164,
        },
        {
            name: "Rare Ornate Cloth",
            image: "cloth/T5_CLOTH_LEVEL2.webp",
            item_value: 128,
            tier: 5,
            enchant: 2,
            focus_cost: 287,
        },
        {
            name: "Exceptional Ornate Cloth",
            image: "cloth/T5_CLOTH_LEVEL3.webp",
            item_value: 256,
            tier: 5,
            enchant: 3,
            focus_cost: 503,
        },
        {
            name: "Pristine Ornate Cloth",
            image: "cloth/T5_CLOTH_LEVEL4.webp",
            item_value: 512,
            tier: 5,
            enchant: 4,
            focus_cost: 880,
        },
        {
            name: "Lavish Cloth",
            image: "cloth/T6_CLOTH.webp",
            item_value: 64,
            tier: 6,
            enchant: 0,
            focus_cost: 164,
        },
        {
            name: "Uncommon Lavish Cloth",
            image: "cloth/T6_CLOTH_LEVEL1.webp",
            item_value: 128,
            tier: 6,
            enchant: 1,
            focus_cost: 287,
        },
        {
            name: "Rare Lavish Cloth",
            image: "cloth/T6_CLOTH_LEVEL2.webp",
            item_value: 256,
            tier: 6,
            enchant: 2,
            focus_cost: 503,
        },
        {
            name: "Exceptional Lavish Cloth",
            image: "cloth/T6_CLOTH_LEVEL3.webp",
            item_value: 512,
            tier: 6,
            enchant: 3,
            focus_cost: 880,
        },
        {
            name: "Pristine Lavish Cloth",
            image: "cloth/T6_CLOTH_LEVEL4.webp",
            item_value: 1024,
            tier: 6,
            enchant: 4,
            focus_cost: 1539,
        },
        {
            name: "Opulent Cloth",
            image: "cloth/T7_CLOTH.webp",
            item_value: 128,
            tier: 7,
            enchant: 0,
            focus_cost: 287,
        },
        {
            name: "Uncommon Opulent Cloth",
            image: "cloth/T7_CLOTH_LEVEL1.webp",
            item_value: 256,
            tier: 7,
            enchant: 1,
            focus_cost: 503,
        },
        {
            name: "Rare Opulent Cloth",
            image: "cloth/T7_CLOTH_LEVEL2.webp",
            item_value: 512,
            tier: 7,
            enchant: 2,
            focus_cost: 880,
        },
        {
            name: "Exceptional Opulent Cloth",
            image: "cloth/T7_CLOTH_LEVEL3.webp",
            item_value: 1024,
            tier: 7,
            enchant: 3,
            focus_cost: 1539,
        },
        {
            name: "Pristine Opulent Cloth",
            image: "cloth/T7_CLOTH_LEVEL4.webp",
            item_value: 2048,
            tier: 7,
            enchant: 4,
            focus_cost: 2694,
        },
        {
            name: "Baroque Cloth",
            image: "cloth/T8_CLOTH.webp",
            item_value: 256,
            tier: 8,
            enchant: 0,
            focus_cost: 503,
        },
        {
            name: "Uncommon Baroque Cloth",
            image: "cloth/T8_CLOTH_LEVEL1.webp",
            item_value: 512,
            tier: 8,
            enchant: 1,
            focus_cost: 880,
        },
        {
            name: "Rare Baroque Cloth",
            image: "cloth/T8_CLOTH_LEVEL2.webp",
            item_value: 1024,
            tier: 8,
            enchant: 2,
            focus_cost: 1539,
        },
        {
            name: "Exceptional Baroque Cloth",
            image: "cloth/T8_CLOTH_LEVEL3.webp",
            item_value: 2048,
            tier: 8,
            enchant: 3,
            focus_cost: 2694,
        },
        {

            name: "Pristine Baroque Cloth",
            image: "cloth/T8_CLOTH_LEVEL4.webp",
            item_value: 4096,
            tier: 8,
            enchant: 4,
            focus_cost: 4714,
        }
    ],
    bar: [
        {
            name: "Copper Bar",
            image: "bar/T2_METALBAR.webp",
            item_value: 4,
            tier: 2,
            enchant: 0,
            focus_cost: 18,
        },
        {
            name: "Bronze Bar",
            image: "bar/T3_METALBAR.webp",
            item_value: 8,
            tier: 3,
            enchant: 0,
            focus_cost: 31,
        },
        {
            name: "Steel Bar",
            image: "bar/T4_METALBAR.webp",
            item_value: 16,
            tier: 4,
            enchant: 0,
            focus_cost: 54,
        },
        {
            name: "Uncommon Steel Bar",
            image: "bar/T4_METALBAR_LEVEL1.webp",
            item_value: 32,
            tier: 4,
            enchant: 1,
            focus_cost: 94,
        },
        {
            name: "Rare Steel Bar",
            image: "bar/T4_METALBAR_LEVEL2.webp",
            item_value: 64,
            tier: 4,
            enchant: 2,
            focus_cost: 164,
        },
        {
            name: "Exceptional Steel Bar",
            image: "bar/T4_METALBAR_LEVEL3.webp",
            item_value: 128,
            tier: 4,
            enchant: 3,
            focus_cost: 287,
        },
        {
            name: "Pristine Steel Bar",
            image: "bar/T4_METALBAR_LEVEL4.webp",
            item_value: 256,
            tier: 4,
            enchant: 4,
            focus_cost: 503,
        },
        {
            name: "Titanium Steel Bar",
            image: "bar/T5_METALBAR.webp",
            item_value: 32,
            tier: 5,
            enchant: 0,
            focus_cost: 94,
        },
        {
            name: "Uncommon Titanium Steel Bar",
            image: "bar/T5_METALBAR_LEVEL1.webp",
            item_value: 64,
            tier: 5,
            enchant: 1,
            focus_cost: 164,
        },
        {
            name: "Rare Titanium Steel Bar",
            image: "bar/T5_METALBAR_LEVEL2.webp",
            item_value: 128,
            tier: 5,
            enchant: 2,
            focus_cost: 287,
        },
        {
            name: "Exceptional Titanium Steel Bar",
            image: "bar/T5_METALBAR_LEVEL3.webp",
            item_value: 256,
            tier: 5,
            enchant: 3,
            focus_cost: 503,
        },
        {
            name: "Pristine Titanium Steel Bar",
            image: "bar/T5_METALBAR_LEVEL4.webp",
            item_value: 512,
            tier: 5,
            enchant: 4,
            focus_cost: 880,
        },
        {
            name: "Runite Steel Bar",
            image: "bar/T6_METALBAR.webp",
            item_value: 64,
            tier: 6,
            enchant: 0,
            focus_cost: 164,
        },
        {
            name: "Uncommon Runite Steel Bar",
            image: "bar/T6_METALBAR_LEVEL1.webp",
            item_value: 128,
            tier: 6,
            enchant: 1,
            focus_cost: 287,
        },
        {
            name: "Rare Runite Steel Bar",
            image: "bar/T6_METALBAR_LEVEL2.webp",
            item_value: 256,
            tier: 6,
            enchant: 2,
            focus_cost: 503,
        },
        {
            name: "Exceptional Runite Steel Bar",
            image: "bar/T6_METALBAR_LEVEL3.webp",
            item_value: 512,
            tier: 6,
            enchant: 3,
            focus_cost: 880,
        },
        {
            name: "Pristine Runite Steel Bar",
            image: "bar/T6_METALBAR_LEVEL4.webp",
            item_value: 1024,
            tier: 6,
            enchant: 4,
            focus_cost: 1539,
        },
        {
            name: "Meteorite Steel Bar",
            image: "bar/T7_METALBAR.webp",
            item_value: 128,
            tier: 7,
            enchant: 0,
            focus_cost: 287,

        },
        {
            name: "Uncommon Meteorite Steel Bar",
            image: "bar/T7_METALBAR_LEVEL1.webp",
            item_value: 256,
            tier: 7,
            enchant: 1,
            focus_cost: 503,
        },
        {
            name: "Rare Meteorite Steel Bar",
            image: "bar/T7_METALBAR_LEVEL2.webp",
            item_value: 512,
            tier: 7,
            enchant: 2,
            focus_cost: 880,
        },
        {
            name: "Exceptional Meteorite Steel Bar",
            image: "bar/T7_METALBAR_LEVEL3.webp",
            item_value: 1024,
            tier: 7,
            enchant: 3,
            focus_cost: 1539,
        },
        {
            name: "Pristine Meteorite Steel Bar",
            image: "bar/T7_METALBAR_LEVEL4.webp",
            item_value: 2048,
            tier: 7,
            enchant: 4,
            focus_cost: 2694,
        },
        {
            name: "Adamantium Steel Bar",
            image: "bar/T8_METALBAR.webp",
            item_value: 256,
            tier: 8,
            enchant: 0,
            focus_cost: 503,
        },
        {
            name: "Uncommon Adamantium Steel Bar",
            image: "bar/T8_METALBAR_LEVEL1.webp",
            item_value: 512,
            tier: 8,
            enchant: 1,
            focus_cost: 880,
        },
        {
            name: "Rare Adamantium Steel Bar",
            image: "bar/T8_METALBAR_LEVEL2.webp",
            item_value: 1024,
            tier: 8,
            enchant: 2,
            focus_cost: 1539,
        },
        {
            name: "Exceptional Adamantium Steel Bar",
            image: "bar/T8_METALBAR_LEVEL3.webp",
            item_value: 2048,
            tier: 8,
            enchant: 3,
            focus_cost: 2694,
        },
        {

            name: "Pristine Adamantium Steel Bar",
            image: "bar/T8_METALBAR_LEVEL4.webp",
            item_value: 4096,
            tier: 8,
            enchant: 4,
            focus_cost: 4714,
        }
    ],
    leather: [
        {
            name: "Stiff Leather",
            image: "leather/T2_LEATHER.webp",
            item_value: 4,
            tier: 2,
            enchant: 0,
            focus_cost: 18,
        },
        {
            name: "Thick Leather",
            image: "leather/T3_LEATHER.webp",
            item_value: 8,
            tier: 3,
            enchant: 0,
            focus_cost: 31,
        },
        {
            name: "Worked Leather",
            image: "leather/T4_LEATHER.webp",
            item_value: 16,
            tier: 4,
            enchant: 0,
            focus_cost: 54,
        },
        {
            name: "Uncommon Worked Leather",
            image: "leather/T4_LEATHER_LEVEL1.webp",
            item_value: 32,
            tier: 4,
            enchant: 1,
            focus_cost: 94,
        },
        {
            name: "Rare Worked Leather",
            image: "leather/T4_LEATHER_LEVEL2.webp",
            item_value: 64,
            tier: 4,
            enchant: 2,
            focus_cost: 164,
        },
        {
            name: "Exceptional Worked Leather",
            image: "leather/T4_LEATHER_LEVEL3.webp",
            item_value: 128,
            tier: 4,
            enchant: 3,
            focus_cost: 287,
        },
        {
            name: "Pristine Worked Leather",
            image: "leather/T4_LEATHER_LEVEL4.webp",
            item_value: 256,
            tier: 4,
            enchant: 4,
            focus_cost: 503,
        },
        {
            name: "Cured Leather",
            image: "leather/T5_LEATHER.webp",
            item_value: 32,
            tier: 5,
            enchant: 0,
            focus_cost: 94,
        },
        {
            name: "Uncommon Cured Leather",
            image: "leather/T5_LEATHER_LEVEL1.webp",
            item_value: 64,
            tier: 5,
            enchant: 1,
            focus_cost: 164,
        },
        {
            name: "Rare Cured Leather",
            image: "leather/T5_LEATHER_LEVEL2.webp",
            item_value: 128,
            tier: 5,
            enchant: 2,
            focus_cost: 287,
        },
        {
            name: "Exceptional Cured Leather",
            image: "leather/T5_LEATHER_LEVEL3.webp",
            item_value: 256,
            tier: 5,
            enchant: 3,
            focus_cost: 503,
        },
        {
            name: "Pristine Cured Leather",
            image: "leather/T5_LEATHER_LEVEL4.webp",
            item_value: 512,
            tier: 5,
            enchant: 4,
            focus_cost: 880,
        },
        {
            name: "Hardened Leather",
            image: "leather/T6_LEATHER.webp",
            item_value: 64,
            tier: 6,
            enchant: 0,
            focus_cost: 164,
        },
        {
            name: "Uncommon Hardened Leather",
            image: "leather/T6_LEATHER_LEVEL1.webp",
            item_value: 128,
            tier: 6,
            enchant: 1,
            focus_cost: 287,
        },
        {
            name: "Rare Hardened Leather",
            image: "leather/T6_LEATHER_LEVEL2.webp",
            item_value: 256,
            tier: 6,
            enchant: 2,
            focus_cost: 503,
        },
        {
            name: "Exceptional Hardened Leather",
            image: "leather/T6_LEATHER_LEVEL3.webp",
            item_value: 512,
            tier: 6,
            enchant: 3,
            focus_cost: 880,
        },
        {
            name: "Pristine Hardened Leather",
            image: "leather/T6_LEATHER_LEVEL4.webp",
            item_value: 1024,
            tier: 6,
            enchant: 4,
            focus_cost: 1539,
        },
        {
            name: "Reinforced Leather",
            image: "leather/T7_LEATHER.webp",
            item_value: 128,
            tier: 7,
            enchant: 0,
            focus_cost: 287,
        },
        {
            name: "Uncommon Reinforced Leather",
            image: "leather/T7_LEATHER_LEVEL1.webp",
            item_value: 256,
            tier: 7,
            enchant: 1,
            focus_cost: 503,
        },
        {
            name: "Rare Reinforced Leather",
            image: "leather/T7_LEATHER_LEVEL2.webp",
            item_value: 512,
            tier: 7,
            enchant: 2,
            focus_cost: 880,
        },
        {
            name: "Exceptional Reinforced Leather",
            image: "leather/T7_LEATHER_LEVEL3.webp",
            item_value: 1024,
            tier: 7,
            enchant: 3,
            focus_cost: 1539,
        },
        {
            name: "Pristine Reinforced Leather",
            image: "leather/T7_LEATHER_LEVEL4.webp",
            item_value: 2048,
            tier: 7,
            enchant: 4,
            focus_cost: 2694,
        },
        {
            name: "Fortified Leather",
            image: "leather/T8_LEATHER.webp",
            item_value: 256,
            tier: 8,
            enchant: 0,
            focus_cost: 503,
        },
        {
            name: "Uncommon Fortified Leather",
            image: "leather/T8_LEATHER_LEVEL1.webp",
            item_value: 512,
            tier: 8,
            enchant: 1,
            focus_cost: 880,
        },
        {
            name: "Rare Fortified Leather",
            image: "leather/T8_LEATHER_LEVEL2.webp",
            item_value: 1024,
            tier: 8,
            enchant: 2,
            focus_cost: 1539,
        },
        {
            name: "Exceptional Fortified Leather",
            image: "leather/T8_LEATHER_LEVEL3.webp",
            item_value: 2048,
            tier: 8,
            enchant: 3,
            focus_cost: 2694,
        },
        {

            name: "Pristine Fortified Leather",
            image: "leather/T8_LEATHER_LEVEL4.webp",
            item_value: 4096,
            tier: 8,
            enchant: 4,
            focus_cost: 4714,
        }
    ],
    plank: [
        {
            name: "Birch Planks",
            image: "planks/T2_PLANKS.webp",
            item_value: 4,
            tier: 2,
            enchant: 0,
            focus_cost: 18,
        },
        {
            name: "Chestnut Planks",
            image: "planks/T3_PLANKS.webp",
            item_value: 8,
            tier: 3,
            enchant: 0,
            focus_cost: 31,
        },
        {
            name: "Pine Planks",
            image: "planks/T4_PLANKS.webp",
            item_value: 16,
            tier: 4,
            enchant: 0,
            focus_cost: 54,
        },
        {
            name: "Uncommon Pine Planks",
            image: "planks/T4_PLANKS_LEVEL1.webp",
            item_value: 32,
            tier: 4,
            enchant: 1,
            focus_cost: 94,
        },
        {
            name: "Rare Pine Planks",
            image: "planks/T4_PLANKS_LEVEL2.webp",
            item_value: 64,
            tier: 4,
            enchant: 2,
            focus_cost: 164,
        },
        {
            name: "Exceptional Pine Planks",
            image: "planks/T4_PLANKS_LEVEL3.webp",
            item_value: 128,
            tier: 4,
            enchant: 3,
            focus_cost: 287,
        },
        {
            name: "Pristine Pine Planks",
            image: "planks/T4_PLANKS_LEVEL4.webp",
            item_value: 256,
            tier: 4,
            enchant: 4,
            focus_cost: 503,
        },
        {
            name: "Cedar Planks",
            image: "planks/T5_PLANKS.webp",
            item_value: 32,
            tier: 5,
            enchant: 0,
            focus_cost: 94,
        },
        {
            name: "Uncommon Cedar Planks",
            image: "planks/T5_PLANKS_LEVEL1.webp",
            item_value: 64,
            tier: 5,
            enchant: 1,
            focus_cost: 164,
        },
        {
            name: "Rare Cedar Planks",
            image: "planks/T5_PLANKS_LEVEL2.webp",
            item_value: 128,
            tier: 5,
            enchant: 2,
            focus_cost: 287,
        },
        {
            name: "Exceptional Cedar Planks",
            image: "planks/T5_PLANKS_LEVEL3.webp",
            item_value: 256,
            tier: 5,
            enchant: 3,
            focus_cost: 503,
        },
        {
            name: "Pristine Cedar Planks",
            image: "planks/T5_PLANKS_LEVEL4.webp",
            item_value: 512,
            tier: 5,
            enchant: 4,
            focus_cost: 880,
        },
        {
            name: "Bloodoak Planks",
            image: "planks/T6_PLANKS.webp",
            item_value: 64,
            tier: 6,
            enchant: 0,
            focus_cost: 164,
        },
        {
            name: "Uncommon Bloodoak Planks",
            image: "planks/T6_PLANKS_LEVEL1.webp",
            item_value: 128,
            tier: 6,
            enchant: 1,
            focus_cost: 287,
        },
        {
            name: "Rare Bloodoak Planks",
            image: "planks/T6_PLANKS_LEVEL2.webp",
            item_value: 256,
            tier: 6,
            enchant: 2,
            focus_cost: 503,
        },
        {
            name: "Exceptional Bloodoak Planks",
            image: "planks/T6_PLANKS_LEVEL3.webp",
            item_value: 512,
            tier: 6,
            enchant: 3,
            focus_cost: 880,
        },
        {
            name: "Pristine Bloodoak Planks",
            image: "planks/T6_PLANKS_LEVEL4.webp",
            item_value: 1024,
            tier: 6,
            enchant: 4,
            focus_cost: 1539,
        },
        {
            name: "Ashenbark Planks",
            image: "planks/T7_PLANKS.webp",
            item_value: 128,
            tier: 7,
            enchant: 0,
            focus_cost: 287,
        },
        {
            name: "Uncommon Ashenbark Planks",
            image: "planks/T7_PLANKS_LEVEL1.webp",
            item_value: 256,
            tier: 7,
            enchant: 1,
            focus_cost: 503,
        },
        {
            name: "Rare Ashenbark Planks",
            image: "planks/T7_PLANKS_LEVEL2.webp",
            item_value: 512,
            tier: 7,
            enchant: 2,
            focus_cost: 880,
        },
        {
            name: "Exceptional Ashenbark Planks",
            image: "planks/T7_PLANKS_LEVEL3.webp",
            item_value: 1024,
            tier: 7,
            enchant: 3,
            focus_cost: 1539,
        },
        {
            name: "Pristine Ashenbark Planks",
            image: "planks/T7_PLANKS_LEVEL4.webp",
            item_value: 2048,
            tier: 7,
            enchant: 4,
            focus_cost: 2694,
        },
        {
            name: "Whitewood Planks",
            image: "planks/T8_PLANKS.webp",
            item_value: 256,
            tier: 8,
            enchant: 0,
            focus_cost: 503,
        },
        {
            name: "Uncommon Whitewood Planks",
            image: "planks/T8_PLANKS_LEVEL1.webp",
            item_value: 512,
            tier: 8,
            enchant: 1,
            focus_cost: 880,
        },
        {
            name: "Rare Whitewood Planks",
            image: "planks/T8_PLANKS_LEVEL2.webp",
            item_value: 1024,
            tier: 8,
            enchant: 2,
            focus_cost: 1539,
        },
        {
            name: "Exceptional Whitewood Planks",
            image: "planks/T8_PLANKS_LEVEL3.webp",
            item_value: 2048,
            tier: 8,
            enchant: 3,
            focus_cost: 2694,
        },
        {
            name: "Pristine Whitewood Planks",
            image: "planks/T8_PLANKS_LEVEL4.webp",
            item_value: 4096,
            tier: 8,
            enchant: 4,
            focus_cost: 4714,
        }
    ],
    stoneblock: [
        {
            name: "Limestone Block",
            image: "stoneblock/T2_STONEBLOCK.webp",
            item_value: 4,
            tier: 2,
            enchant: 0,
            focus_cost: 18,
        },
        {
            name: "Sandstone Block",
            image: "stoneblock/T3_STONEBLOCK.webp",
            item_value: 8,
            tier: 3,
            enchant: 0,
            focus_cost: 18,
        },
        {
            name: "Travertine Block",
            image: "stoneblock/T4_STONEBLOCK.webp",
            item_value: 16,
            tier: 4,
            enchant: 0,
            focus_cost: 54,
        },
        {
            name: "Travertine Block",
            image: "stoneblock/T4_STONEBLOCK.webp",
            item_value: 16,
            tier: 4,
            enchant: 1,
            focus_cost: 108,
        },
        {
            name: "Travertine Block",
            image: "stoneblock/T4_STONEBLOCK.webp",
            item_value: 16,
            tier: 4,
            enchant: 2,
            focus_cost: 216,
        },
        {
            name: "Travertine Block",
            image: "stoneblock/T4_STONEBLOCK.webp",
            item_value: 16,
            tier: 4,
            enchant: 3,
            focus_cost: 432,
        },
        {
            name: "Granite Block",
            image: "stoneblock/T5_STONEBLOCK.webp",
            item_value: 32,
            tier: 5,
            enchant: 0,
            focus_cost: 94,
        },
        {
            name: "Granite Block",
            image: "stoneblock/T5_STONEBLOCK.webp",
            item_value: 32,
            tier: 5,
            enchant: 1,
            focus_cost: 188,
        },
        {
            name: "Granite Block",
            image: "stoneblock/T5_STONEBLOCK.webp",
            item_value: 32,
            tier: 5,
            enchant: 2,
            focus_cost: 376,
        },
        {
            name: "Granite Block",
            image: "stoneblock/T5_STONEBLOCK.webp",
            item_value: 32,
            tier: 5,
            enchant: 3,
            focus_cost: 752,
        },
        {
            name: "Slate Block",
            image: "stoneblock/T6_STONEBLOCK.webp",
            item_value: 64,
            tier: 6,
            enchant: 0,
            focus_cost: 164,
        },
        {
            name: "Slate Block",
            image: "stoneblock/T6_STONEBLOCK.webp",
            item_value: 64,
            tier: 6,
            enchant: 1,
            focus_cost: 328,
        },
        {
            name: "Slate Block",
            image: "stoneblock/T6_STONEBLOCK.webp",
            item_value: 64,
            tier: 6,
            enchant: 2,
            focus_cost: 656,
        },
        {
            name: "Slate Block",
            image: "stoneblock/T6_STONEBLOCK.webp",
            item_value: 64,
            tier: 6,
            enchant: 3,
            focus_cost: 1312,
        },
        {
            name: "Basalt Block",
            image: "stoneblock/T7_STONEBLOCK.webp",
            item_value: 128,
            tier: 7,
            enchant: 0,
            focus_cost: 287,
        },
        {
            name: "Basalt Block",
            image: "stoneblock/T7_STONEBLOCK.webp",
            item_value: 128,
            tier: 7,
            enchant: 1,
            focus_cost: 574,
        },
        {
            name: "Basalt Block",
            image: "stoneblock/T7_STONEBLOCK.webp",
            item_value: 128,
            tier: 7,
            enchant: 2,
            focus_cost: 1148,
        },
        {
            name: "Basalt Block",
            image: "stoneblock/T7_STONEBLOCK.webp",
            item_value: 128,
            tier: 7,
            enchant: 3,
            focus_cost: 2296,
        },
        {
            name: "Marble Block",
            image: "stoneblock/T8_STONEBLOCK.webp",
            item_value: 256,
            tier: 8,
            enchant: 0,
            focus_cost: 503,
        },
        {
            name: "Marble Block",
            image: "stoneblock/T8_STONEBLOCK.webp",
            item_value: 256,
            tier: 8,
            enchant: 1,
            focus_cost: 1006,
        },
        {
            name: "Marble Block",
            image: "stoneblock/T8_STONEBLOCK.webp",
            item_value: 256,
            tier: 8,
            enchant: 2,
            focus_cost: 2012,
        },
        {
            name: "Marble Block",
            image: "stoneblock/T8_STONEBLOCK.webp",
            item_value: 256,
            tier: 8,
            enchant: 3,
            focus_cost: 4024,
        }
    ]
}

function init() {

    document.getElementById("resouce-table-body").innerHTML = "";

    let refining_resource = document.getElementById("refining-resource").value;
    let refining_resource_list = {};
    let refining_product_list = {};
    switch (refining_resource) {
        case "0":
            refining_resource_list = resources.fiber;
            refining_product_list = products.cloth;
            break;
        case "1":
            refining_resource_list = resources.ore;
            refining_product_list = products.bar;
            break;
        case "2":
            refining_resource_list = resources.hide;
            refining_product_list = products.leather;
            break;
        case "3":
            refining_resource_list = resources.wood;
            refining_product_list = products.plank;
            break;
        case "4":
            refining_resource_list = resources.rock;
            refining_product_list = products.stoneblock;
    }

    for (let i = 0; i < refining_resource_list.length; i++) {
        let row = document.createElement("tr");

        let resource_tier = document.createElement("td");
        resource_tier.innerHTML = refining_resource_list[i].tier + "." + refining_resource_list[i].enchant;
        resource_tier.className = refining_product_list[i].item_value;
        row.appendChild(resource_tier);

        let resource_image = document.createElement("td");
        let resource_image_element = document.createElement("img");
        resource_image_element.src = "images/resources/" + refining_resource_list[i].image;
        resource_image_element.style.width = "75px";
        resource_image_element.style.height = "75px";
        resource_image_element.alt = refining_resource_list[i].name + " " + refining_resource_list[i].tier + "." + refining_resource_list[i].enchant + " image";

        resource_image_element.onclick = function() {
            copySearchString(refining_resource_list[i].name);
        }

        resource_image.appendChild(resource_image_element);
        row.appendChild(resource_image);

        let resource_price_input = document.createElement("td");
        let resource_price_input_element = document.createElement("input");
        resource_price_input_element.id = "resource-price-input-" + refining_resource_list[i].tier + "." + refining_resource_list[i].enchant;
        resource_price_input_element.type = "number";
        resource_price_input_element.value = 0;
        resource_price_input_element.onclick = function () {
            this.select();
        }
        resource_price_input_element.oninput = function () {
            updateNumbers(this);
        }
        resource_price_input.appendChild(resource_price_input_element);
        row.appendChild(resource_price_input);

        let product_image = document.createElement("td");
        let product_image_element = document.createElement("img");
        product_image_element.src = "images/resources/" + refining_product_list[i].image;
        product_image_element.style.width = "75px";
        product_image_element.style.height = "75px";
        product_image_element.alt = refining_product_list[i].name + " " + refining_product_list[i].tier + "." + refining_product_list[i].enchant + " image";

        product_image_element.onclick = function () {
            copySearchString(refining_product_list[i].name);
        }

        product_image.appendChild(product_image_element);
        row.appendChild(product_image);

        let product_price = document.createElement("td");
        let product_price_element = document.createElement("input");
        product_price_element.id = "product-price-input-" + refining_product_list[i].tier + "." + refining_resource_list[i].enchant;
        product_price_element.type = "number";
        product_price_element.value = 0;
        product_price_element.onclick = function () {
            this.select();
        }
        product_price_element.oninput = function () {
            updateNumbers(this);
        }
        product_price.appendChild(product_price_element);
        row.appendChild(product_price);

        let profit = document.createElement("td");
        let profit_element = document.createElement("p");
        profit_element.innerHTML = "0";
        profit.appendChild(profit_element);
        row.appendChild(profit);

        let profit_percentage = document.createElement("td");
        let profit_percentage_element = document.createElement("p");
        profit_percentage_element.innerHTML = "0%";
        profit_percentage.appendChild(profit_percentage_element);
        row.appendChild(profit_percentage);

        let focus_cost = document.createElement("td");
        let focus_cost_element = document.createElement("p");
        focus_cost_element.innerHTML = "0"
        focus_cost_element.id = refining_product_list[i].focus_cost;
        focus_cost.id = "focus-column";
        focus_cost.appendChild(focus_cost_element);
        row.appendChild(focus_cost);

        let focus_profit = document.createElement("td");
        let focus_profit_element = document.createElement("p");
        focus_profit_element.innerHTML = "0";
        focus_profit.id = "focus-column";
        focus_profit.appendChild(focus_profit_element);
        row.appendChild(focus_profit);

        let profit_per_focus = document.createElement("td");
        let profit_per_focus_element = document.createElement("p");
        profit_per_focus_element.innerHTML = "0";
        profit_per_focus.id = "focus-column";
        profit_per_focus.appendChild(profit_per_focus_element);
        row.appendChild(profit_per_focus);

        let total_resource_cost = document.createElement("td");
        let total_resource_cost_element = document.createElement("p");
        total_resource_cost_element.innerHTML = "0";
        total_resource_cost.id = "detail-column";
        total_resource_cost.appendChild(total_resource_cost_element);
        row.appendChild(total_resource_cost);

        let station_tax_detail = document.createElement("td");
        let station_tax_detail_element = document.createElement("p");
        station_tax_detail_element.innerHTML = "0";
        station_tax_detail.id = "detail-column";
        station_tax_detail.appendChild(station_tax_detail_element);
        row.appendChild(station_tax_detail);

        let market_tax_detail = document.createElement("td");
        let market_tax_detail_element = document.createElement("p");
        market_tax_detail_element.innerHTML = "0";
        market_tax_detail.id = "detail-column";
        market_tax_detail.appendChild(market_tax_detail_element);
        row.appendChild(market_tax_detail);

        document.getElementById("resouce-table-body").appendChild(row);
    }

    if(document.getElementById("table-settings-flip-table").checked) {
        flipTable();
    }

    loadFromLocalStorage("init");
    updateMastery();
    updateNumbers();
    updateFocus();

    if(document.getElementById("table-settings-hide-rows").checked) {
        document.getElementById("table-settings-hide-rows").click();
    }

    document.getElementById("table-failed-loading-error").innerHTML = "";
}

function loadFromLocalStorage(type) {
    let table = document.getElementById("resouce-table-body");

    let refining_resource = document.getElementById("refining-resource").value;
    for (let i = 0; i < table.rows.length; i++) {
        let tier = table.rows[i].cells[0].innerHTML;
        let resource_price = localStorage.getItem(refining_resource+"resource-price-input-" + tier);
        let product_price = localStorage.getItem(refining_resource+"product-price-input-" + tier);

        if(resource_price != null) {
            table.rows[i].cells[2].getElementsByTagName("input")[0].value = resource_price;
        }
        if(product_price != null) {
            table.rows[i].cells[4].getElementsByTagName("input")[0].value = product_price;
        }
        
        let enchant = tier.split(".")[1];
        let hideEnchant = localStorage.getItem("hide-enchant-"+enchant);
        if(hideEnchant != null && hideEnchant == "true") {
            table.rows[i].classList.add("hidden-row");
            let button = document.getElementById("hide-enchants-button-"+enchant);
            if(button != null) {
                button.classList.add("button-is-active");
            }
        }
    }

    if(type == "init") return;
    updateElementFromLocalStorage("refining-market-tax", true);
    updateElementFromLocalStorage("refining-market-tax-percentage", false);
    updateElementFromLocalStorage("profile-settings-focus-columns", true);
    updateElementFromLocalStorage("profile-settings-detail-columns", true);
    updateElementFromLocalStorage("table-settings-flip-table", true);
    updateElementFromLocalStorage("server-select", false);
    updateElementFromLocalStorage("refining-city-resource", false);
    updateElementFromLocalStorage("refining-city-product", false);
    updateElementFromLocalStorage("time-period-select", false)
    updateElementFromLocalStorage("price-type-select", false);
    updateElementFromLocalStorage("refining-resource", false);
    updateElementFromLocalStorage("refining-station-return-rate", false);
    updateElementFromLocalStorage("daily-production-bonus", false);
    updateElementFromLocalStorage("refining-station-amount", false);
    updateElementFromLocalStorage("refining-station-tax", false);
    updateElementFromLocalStorage("refining-max-resource-price-percentage", false);

    if(localStorage.getItem("custom-return-rate") != null) {
        const storedValue = localStorage.getItem("custom-return-rate");
        let selected_return_rate = document.getElementById("refining-station-return-rate");
        selected_return_rate.options[selected_return_rate.options.length-1].innerText = "Custom (" + storedValue + "%)";
        selected_return_rate.options[selected_return_rate.options.length-1].value = storedValue;
    }
}

function updateElementFromLocalStorage(elementId, isCheckbox) {
    const storedValue = localStorage.getItem(elementId);

    if (storedValue !== null) {
        const element = document.getElementById(elementId);
        if (isCheckbox) {
            let bool = (storedValue === "true");
            if(bool) {
                element.click();
            }
        } else {
            element.value = storedValue;
        }
    }

    if(elementId == "table-settings-flip-table") {
        if(document.getElementById("table-settings-flip-table").checked) {
            flipTable();
        }
    }
}

function updateNumbers(element) {
    let refining_resource = document.getElementById("refining-resource").value;

    if(element != null) {
        validateInput(element);
        let element_id = element.id;
        if(element_id != null) {
            if(element_id.includes("product-price-input-") || element_id.includes("resource-price-input-")) {
                let elementValue = document.getElementById(element_id).value;
                if(elementValue < 0 || elementValue == "") {
                    elementValue = 0;
                    document.getElementById(element_id).value = 0;
                }   
                localStorage.setItem(refining_resource+element_id, elementValue);

                element.style.borderBottomColor = "#cbe4de";
            }
            if(element_id.includes("refining-mastery-t")) {
                let elementValue = document.getElementById(element_id).value;
                localStorage.setItem(refining_resource+element_id, elementValue);
            }
        }
    }

    let tax = document.getElementById("refining-station-tax").value;
    let return_rate = getReturnRate(false);
    let craft_amount = document.getElementById("refining-station-amount").value;

    let table = document.getElementById("resouce-table-body");
    for (let i = 0; i < table.rows.length; i++) {

        if(table.rows[i].cells[2].getElementsByTagName("input")[0].value == 0 || table.rows[i].cells[4].getElementsByTagName("input")[0].value == 0) {
            table.rows[i].cells[5].children[0].innerHTML = "0";
            table.rows[i].cells[6].children[0].innerHTML = "0%";
            continue;
        }

        let resource_cost = getResourceCosts()[i];

        let product_price = table.rows[i].cells[4].children[0].value;
        let item_value = table.rows[i].cells[0].className;
        let tax_cost = ((item_value * 0.1125)*tax)/100;

        let tier = table.rows[i].cells[0].innerHTML;
        
        if(table.rows[i].cells[0].innerHTML == "2.0") tax_cost = 0;

        let profit = (product_price - resource_cost + (resource_cost/100*return_rate) - tax_cost)*craft_amount;


        let market_tax = document.getElementById("refining-market-tax-percentage").value/100;
        let market_tax_cost = (product_price*market_tax)*craft_amount;
        if(document.getElementById("refining-market-tax").checked) {
            profit = profit - market_tax_cost;
        }

        if(document.getElementById("refine-from").checked) {
            if(tier[0] > document.getElementById("refine-from-dropdown").value) {
                let offset = getOffset(tier);
                let previous_profit = table.rows[i-offset].cells[5].children[0].innerHTML;
                profit = profit + parseFloat(previous_profit);
            }
        }

        // let profit_percentage = (profit / (resource_cost*craft_amount)) * 100;
        let profit_percentage = (profit / ((product_price*(1-market_tax))*craft_amount)) * 100;
        
        let label_prefix = "<a href='#' class='missing_resource_tooltip' style='color:red;text-decoration:none;' title='Missing price of previous tier product'>";
        let label_suffix = " (!)</a>";
        if(tier != "2.0") {
            let value = table.rows[i-getOffset(tier)].cells[4].children[0].value;
            if(value != 0) label_prefix = "", label_suffix = "";
        } else {
            label_prefix = "", label_suffix = "";
        }

        table.rows[i].cells[5].children[0].innerHTML = label_prefix + profit.toFixed(0) + label_suffix;
        table.rows[i].cells[6].children[0].innerHTML = label_prefix + profit_percentage.toFixed(2) + "%" + label_suffix;
        
        table.rows[i].cells[10].children[0].innerHTML = (resource_cost*craft_amount).toFixed(0);
        table.rows[i].cells[11].children[0].innerHTML = (tax_cost*craft_amount).toFixed(0);
        table.rows[i].cells[12].children[0].innerHTML = (market_tax_cost).toFixed(0);

        colorProfits(table.rows[i].cells[5].children[0]);
        colorProfits(table.rows[i].cells[6].children[0]);
    }
    updateFocus();
}

function clearTable(type) {
    let table = document.getElementById("resouce-table-body");
    if(type == "table") {
        let refining_resource = document.getElementById("refining-resource").value;
        for (let i = 0; i < table.rows.length; i++) {
            localStorage.removeItem(refining_resource+"resource-price-input-" + table.rows[i].cells[0].innerHTML);
            localStorage.removeItem(refining_resource+"product-price-input-" + table.rows[i].cells[0].innerHTML);
        }
    } else {
        localStorage.clear();
    
        for(let i = 4; i < 9; i++) {
            document.getElementById("refining-mastery-t" + i).value = 0;
        }
    }

    init();
}

function updateMastery() {
    let refining_resource = document.getElementById("refining-resource").value;
    for(let i = 4; i < 9; i++) {
        let refining_mastery = localStorage.getItem(refining_resource+"refining-mastery-t" + i);
        if(refining_mastery != null) {
            document.getElementById("refining-mastery-t" + i).value = refining_mastery;
        }
        else {
            document.getElementById("refining-mastery-t" + i).value = 0;
        }
    }
}

function updateFocus() {
    let t4_mastery = parseInt(document.getElementById("refining-mastery-t4").value);
    let t5_mastery = parseInt(document.getElementById("refining-mastery-t5").value);
    let t6_mastery = parseInt(document.getElementById("refining-mastery-t6").value);
    let t7_mastery = parseInt(document.getElementById("refining-mastery-t7").value);
    let t8_mastery = parseInt(document.getElementById("refining-mastery-t8").value);

    let craft_amount = parseInt(document.getElementById("refining-station-amount").value);

    let table = document.getElementById("resouce-table-body");
    for (let i = 0; i < table.rows.length; i++) {

        if(table.rows[i].cells[2].getElementsByTagName("input")[0].value == 0 || table.rows[i].cells[4].getElementsByTagName("input")[0].value == 0) continue;
        
        let tier = table.rows[i].cells[0].innerHTML;
        let focus_efficiency = t4_mastery*30 + t5_mastery*30 + t6_mastery*30 + t7_mastery*30 + t8_mastery*30;

        switch (tier[0]) {
            case "4":
                focus_efficiency += t4_mastery*250;
                break;
            case "5":
                focus_efficiency += t5_mastery*250;
                break;
            case "6":
                focus_efficiency += t6_mastery*250;
                break;
            case "7":
                focus_efficiency += t7_mastery*250;
                break;
            case "8":
                focus_efficiency += t8_mastery*250;
                break;
        }

        let base_focus_cost = parseInt(table.rows[i].cells[7].children[0].id);
        let focus_cost = (base_focus_cost*0.5**(focus_efficiency/10000))*craft_amount;

        let tax = document.getElementById("refining-station-tax").value;

        let product_price = table.rows[i].cells[4].children[0].value;
        let item_value = table.rows[i].cells[0].className;
        let tax_cost = ((item_value * 0.1125)*tax)/100;

        let return_rate = getReturnRate(true)

        let resource_cost = getResourceCosts()[i];

        let focus_profit = (product_price - resource_cost + (resource_cost/100*return_rate) - tax_cost)*craft_amount;

        if(document.getElementById("refining-market-tax").checked) {
            focus_profit = focus_profit - (focus_profit*0.065);
        }

        let profit_per_focus = focus_profit/focus_cost;

        table.rows[i].cells[7].children[0].innerHTML = Math.ceil(focus_cost);
        table.rows[i].cells[8].children[0].innerHTML = focus_profit.toFixed(0);
        table.rows[i].cells[9].children[0].innerHTML = profit_per_focus.toFixed(0);

        colorProfits(table.rows[i].cells[8].children[0]);
        colorProfits(table.rows[i].cells[9].children[0]);
    }
}

function validateInput(element) {
    let value = element.value;

    if(element.value[0] == "0" && element.value.length > 1) {
        element.value = element.value.substring(1);
    }

    if (isNaN(value) || value == "" || value == null || value < 0) {
        element.value = 0;
    }

    if(element.id.includes("refining-mastery-t")) {
        if(value > 100) {
            element.value = 100;
            return;
        }
        return;
    }

    if(element.id == "refining-station-tax") {
        if(value > 9999) {
            element.value = 9999;
            return;
        }
    }

    if(element.id == "refining-station-amount") {
        if(value < 1) {
            element.value = 1;
            return;
        }
    }
}

function getResourceCosts() {
    const table = document.getElementById("resouce-table-body");
    let refining_resource = document.getElementById("refining-resource").value;

    const resource_prices = [];
  
    const tierMultipliers = {
        "2": 1,
        "3": 2,
        "4": 2,
        "5": 3,
        "6": 4,
        "7": 5,
        "8": 5,
    };
  
    for (let i = 0; i < table.rows.length; i++) {
        const tier = table.rows[i].cells[0].innerHTML;
        let resource_price = +table.rows[i].cells[2].children[0].value;
        let offset = getOffset(tier);
        let prevValue = i - offset >= 0 ? +table.rows[i - offset].cells[4].children[0].value : 0;
        const multiplier = tierMultipliers[tier[0]];

        let tempcost = resource_price;
        if(refining_resource == "4") {
            let enchant = tier[2];
            if(enchant == "1") resource_price = resource_price/2;
            else if(enchant == "2") resource_price = resource_price/4;
            else if(enchant == "3") resource_price = resource_price/8;
        }

        let resource_cost = resource_price * multiplier + prevValue;

        tier == "2.0" ? resource_prices.push(resource_price) : resource_prices.push(resource_cost);
    }
  
    return resource_prices;
}

function colorProfits(row) {
    if(row.innerHTML.includes("-")) {
        row.style.color = "red";
    } else {
        row.style.color = "green";
    }
}

function getOffset(tier) {
    let refining_resource = document.getElementById("refining-resource").value;

    let offset = refining_resource == "4" ? 4 : 5;
    if(tier == "3.0" || tier == "4.0") {
        offset = 1;
    } else if (tier == "4.1") {
        offset = 2;
    } else if (tier == "4.2") {
        offset = 3;
    } else if (tier == "4.3") {
        offset = 4;
    } else if(tier == "2.0") {
        offset = -1;
    }

    let flipped = document.getElementById("table-settings-flip-table").checked;
    if(flipped) {
        offset = offset * -1;
    }
    return offset;
}

function toggleColumns() {
    let focus_switch = document.getElementById("profile-settings-focus-columns");
    let detail_switch = document.getElementById("profile-settings-detail-columns");

    let width = !focus_switch.checked ? "100%" : detail_switch.checked ? "75%" : "60%";
    
    let window_width = window.innerWidth;
    if (window_width < 1050) {
        width = "100%";
    } else if (window_width < 1300) {
        width = "90%";
    }

    document.getElementById("refining-table").classList.toggle("focus-table", focus_switch.checked);
    document.getElementById("refining-table").classList.toggle("detail-table", !detail_switch.checked);

    document.getElementById("refining-table").style.width = width;
}

function flipTable() {

    let table = document.getElementById("resouce-table-body");
    let rows = table.rows;
    var numRows = rows.length;
    var temp = [];
  
    for (var i = 0; i < numRows; i++) {
      temp.push(rows[i]);
    }
  
    while (table.firstChild) {
      table.removeChild(table.firstChild);
    }
  
    for (var i = numRows - 1; i >= 0; i--) {
      table.appendChild(temp[i]);
    }
}

function hideRows() {
    let table = document.getElementById("resouce-table-body");
    let rows = table.rows;
    let hide_switch = document.getElementById("table-settings-hide-rows");
    for(let i = 0; i < rows.length; i++) {
        let value1 = rows[i].cells[2].children[0].value;
        let value2 = rows[i].cells[4].children[0].value;
        if(value1 == 0 && value2 == 0) {
            rows[i].classList.toggle("hidden-row", hide_switch.checked);
        }
    }
}

function hideEnchant(enchant) {
    let table = document.getElementById("resouce-table-body");
    let rows = table.rows;
    for(let i = 0; i < rows.length; i++) {
        let foundEnchant = rows[i].cells[0].innerHTML.split(".")[1];
        if(foundEnchant == enchant) {
            rows[i].classList.toggle("hidden-row");
        }
    }

    let button = document.getElementById("hide-enchants-button-"+enchant);
    button.classList.toggle("button-is-active");

    if(localStorage.getItem("hide-enchant-"+enchant) == "true") {
        localStorage.setItem("hide-enchant-"+enchant, "false");
    } else {
        localStorage.setItem("hide-enchant-"+enchant, "true");
    }
}

function pullPrices(resources) {
    let pull_price_type = document.getElementById("price-type-select").value;
    if(pull_price_type == "average") {
        pullAveragePrices(resources);
    } else {
        pullCurrentPrices(resources);
    }
}

function pullCurrentPrices(resources) {
    console.log("pullCurrentPrices", resources);
    let offset = (resources ? 2 : 0);

    let table = document.getElementById("resouce-table-body");
    for(let i = 0; i < table.rows.length; i++) {
        table.rows[i].cells[4-offset].children[0].value = 0;
    }

    let flipped = document.getElementById("table-settings-flip-table").checked;
    if(flipped) {
        flipTable();
    }

    let element_id = resources ? "refining-city-resource" : "refining-city-product";

    let server = document.getElementById("server-select").value;
    let city = document.getElementById(element_id).value;

    let item_list = "";
    for(let i = 0; i < table.rows.length; i++) {
        let img_value = table.rows[i].cells[3-offset].innerHTML.split("/");
        let item_id = img_value[img_value.length-1].split(".")[0];

        if(item_id[item_id.length-1] >= '0' && item_id[item_id.length-1] <= '9') {
            let enchant = item_id[item_id.length-1];
            item_id = item_id.replace("_LEVEL"+enchant, "_LEVEL"+enchant+"@"+enchant);
        }

        item_list += item_id + ",";
    }

    let refining_resource = document.getElementById("refining-resource").value;
    let valArr = [0,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6]

    let url = "https://"+server+".albion-online-data.com/api/v2/stats/prices/"+item_list+"?locations="+city;
    fetch(url)
    .then(response => response.json())
    .then(data => {
        for(let i = 0; i < table.rows.length; i++) {
            let index = refining_resource == "4" && !resources ? valArr[i] : i;
            let price;

            if (data[index] && data[index].sell_price_min !== null) {
                price = data[index].sell_price_min;
            }

            let price_cell = table.rows[i].cells[4-offset].children[0];
            price_cell.value = (price || 0);
           
            if(data[index]) {
                try {
                    changeAgeIndicator(price_cell, data[index].sell_price_min_date);
                } catch (error) {
                    console.log(error);
                }
            }
        }
    }
    ).then(() => {
        if(flipped) {
            flipTable();
        }
    }
    ).finally(() => {
        updateNumbers();
    });
}

function pullAveragePrices(resources) {

    let offset = (resources ? 2 : 0);

    let table = document.getElementById("resouce-table-body");
    for(let i = 0; i < table.rows.length; i++) {
        table.rows[i].cells[4-offset].children[0].value = 0;
    }

    let flipped = document.getElementById("table-settings-flip-table").checked;
    if(flipped) {
        flipTable();
    }

    let element_id = resources ? "refining-city-resource" : "refining-city-product";

    let server = document.getElementById("server-select").value;
    let city = document.getElementById(element_id).value;
    let time_period = document.getElementById("time-period-select").value;

    let item_list = "";
    for(let i = 0; i < table.rows.length; i++) {
        let img_value = table.rows[i].cells[3-offset].innerHTML.split("/");
        let item_id = img_value[img_value.length-1].split(".")[0];

        if(item_id[item_id.length-1] >= '0' && item_id[item_id.length-1] <= '9') {
            let enchant = item_id[item_id.length-1];
            item_id = item_id.replace("_LEVEL"+enchant, "_LEVEL"+enchant+"@"+enchant);
        }

        item_list += item_id + ",";
    }

    let refining_resource = document.getElementById("refining-resource").value;
    let valArr = [0,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6]

    let url = "https://"+server+".albion-online-data.com/api/v2/stats/history/"+item_list+"?time-scale="+(time_period > 24 ? 24 : time_period)+"&locations="+city;
    fetch(url)
    .then(response => response.json())
    .then(data => {
        for(let i = 0; i < table.rows.length; i++) {
            let index = refining_resource == "4" ? valArr[i] : i;
            let price;

            if (data[index] && data[index].data && data[index].data.length > 0 && data[index].data[0].avg_price !== null) {
                data[index].data.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                if (time_period <= 24) {
                    price = data[index].data[0].avg_price;
                } else {
                    let sum = 0;
                    const numDataPoints = Math.min(time_period / 24, data[index].data.length);
                    for (let j = 0; j < numDataPoints; j++) {
                        if (data[index].data[j] && data[index].data[j].avg_price !== null) {
                            sum += data[index].data[j].avg_price;
                        }
                    }
                    if (sum !== 0) {
                        price = Math.round(sum / (time_period / 24));
                    }
                }
            }

            let price_cell = table.rows[i].cells[4-offset].children[0];

            price_cell.value = (price || 0);
        }
    }
    ).then(() => {
        if(flipped) {
            flipTable();
        }
    }
    ).finally(() => {
        updateNumbers();
    });
}

function findResourceZCost() {
    let table = document.getElementById("resouce-table-body");

    let station_tax = document.getElementById("refining-station-tax").value;
    let return_rate = getReturnRate(false);
    let tax_rate = 0;
    if(document.getElementById("refining-market-tax").checked) tax_rate = document.getElementById("refining-market-tax-percentage").value/100;

    for(let i = 0; i < table.rows.length; i++) {

        let tier = table.rows[i].cells[0].innerHTML;

        let item_value = table.rows[i].cells[0].className;
        let tax_cost = ((item_value * 0.1125)*station_tax)/100;
        let resources_needed = tierMultipliers[tier[0]];

        let product_value = table.rows[i].cells[4].children[0].value;
        let previous_product = 0;
        if(tier == "2.0") {
            previous_product = 0;
            tax_cost = 0;
        } else {
            previous_product = table.rows[i-getOffset(tier)].cells[4].children[0].value;
        }

        if(tier != "2.0" && (product_value == 0 || previous_product == 0)) continue;

        let zMax = maxZ(product_value, previous_product, return_rate, tax_cost, tax_rate, resources_needed);
        table.rows[i].cells[2].children[0].value = zMax.toFixed(0);
    }

    updateNumbers();
}

function maxZ(product_value, previous_product, return_rate, usage_fee, tax_rate, resources_needed) {
    let profit_percentage = document.getElementById("refining-max-resource-price-percentage").value

    return (product_value * (1-profit_percentage/100) * (1 - tax_rate) - previous_product + (previous_product * return_rate) / 100 - usage_fee) / (resources_needed - (resources_needed * return_rate) / 100) 
}

const tierMultipliers = {
    "2": 1,
    "3": 2,
    "4": 2,
    "5": 3,
    "6": 4,
    "7": 5,
    "8": 5,
  };

function saveSettings(element) {
    let id = element.id;
    let value = element.type == "checkbox" ? element.checked : element.value;

    if (typeof(Storage) !== "undefined" && localStorage.getItem(id) !== value.toString()) {
        localStorage.setItem(id, value);
    }
}

function getReturnRate(focus) {
    let selected_return_rate = parseFloat(document.getElementById("refining-station-return-rate").value);
    let daily_production_bonus = parseFloat(document.getElementById("daily-production-bonus").value);
    
    let return_rate = selected_return_rate;

    if(daily_production_bonus > 0) {
        switch(selected_return_rate) {
            case 15.2: daily_production_bonus == 10 ? return_rate = 21.8 : return_rate = 27.5; break;
            case 36.7: daily_production_bonus == 10 ? return_rate = 40.4 : return_rate = 43.8; break;
            case 0: daily_production_bonus == 10 ? return_rate = 9.0 : return_rate = 16.6; break;
            case 28.5: daily_production_bonus == 10 ? return_rate = 33.3 : return_rate = 37.5; break;
        }
    }

    if(focus) {
        switch(return_rate) {
            // 0% Bonus
            case 15.2: return_rate = 43.5; break;
            case 36.7: return_rate = 53.9; break;
            case 0: return_rate = 37.1; break;
            case 28.5: return_rate = 49.7; break;

            // 10% Bonus
            case 21.8: return_rate = 46.5; break;
            case 40.4: return_rate = 55.9; break;
            case 9.0: return_rate = 40.8; break;
            case 33.3: return_rate = 52.1; break;

            // 20% Bonus
            case 27.5: return_rate = 49.2; break;
            case 43.8: return_rate = 57.8; break;
            case 16.6: return_rate = 44.1; break;
            case 37.5: return_rate = 54.3; break;
        }
    }
    
    return return_rate;
}

function customReturnRate() {

    let selected_return_rate = document.getElementById("refining-station-return-rate");
    if(selected_return_rate.selectedIndex == selected_return_rate.length-1) {
        let previous_value = localStorage.getItem("custom-return-rate") != null ? localStorage.getItem("custom-return-rate") : 0.0;
        let custom_return_rate = parseFloat(prompt("Enter custom return rate percentage.\n\nNumbers related to focus and production bonus"
        + " will not show the correct numbers with a custom return rate and should therefore be ignored.", previous_value));
        if(custom_return_rate == null || custom_return_rate == "" || isNaN(custom_return_rate)) {
            custom_return_rate = 0.0;
        }

        selected_return_rate.options[selected_return_rate.length-1].innerText = "Custom (" + custom_return_rate + "%)";
        selected_return_rate.options[selected_return_rate.length-1].value = custom_return_rate;
        selected_return_rate.selectedIndex = selected_return_rate.length-1;

        localStorage.setItem("custom-return-rate", custom_return_rate);
    }

}

function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                timeout = null;
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
  }
  
const handleResize = debounce(function() {
    let window_width = window.innerWidth;
    if (window_width < 1050) {
        document.getElementById("refining-table").style.width = "100%";
    } else if (window_width < 1300) {
        document.getElementById("refining-table").style.width = "90%";
    } else {
        toggleColumns();
    }
}, 30);

function toggleTutorialPopup() {
    var popup = document.getElementById("tutorial-popup");
    var display = document.getElementById("tutorial-popup").style.display;
    popup.style.display = display == "none" ? "block" : "none";
}

function editPullPriceType() {
    let pull_price_type = document.getElementById("price-type-select").value;

    if(pull_price_type == "average") {
        document.getElementById("period-select-div").style.display = "block";
    } else {
        document.getElementById("period-select-div").style.display = "none";
    }
}

function changeAgeIndicator(element, age) {
    const priceDate = new Date(age);
    const dateUTC0 = new Date(new Date().toLocaleString('en', { timeZone: 'Etc/UTC' }));

    const diff = Math.abs(dateUTC0 - priceDate) / 1000 / 60;

    if (diff < 30) {
        element.style.borderBottomColor = "green";
    } else if (diff < 240) {
        element.style.borderBottomColor = "yellow";
    } else {
        element.style.borderBottomColor = "#cc6600";
    }
}

function copySearchString(string) {
    var dummy = document.createElement("textarea");
    document.body.appendChild(dummy);
    dummy.value = string;
    dummy.select();
    document.execCommand("copy");
    document.body.removeChild(dummy);

    var tooltip = document.getElementById("copy-tooltip");
    tooltip.style.display = "block";
    setTimeout(function() {
        tooltip.style.display = "none";
    }, 1200);
}


window.addEventListener("resize", handleResize);

loadFromLocalStorage();
init();
editPullPriceType();